function fullScreen(e){"active"==e.status&&e.tabId&&chrome.windows.getCurrent((function(t){const a=t.id;!0!==LocalStorage.load("fullScreen")?!0===e.fullscreen?(LocalStorage.save("windowState",t.state),chrome.windows.update(a,{state:"fullscreen"},null)):chrome.windows.update(a,{state:LocalStorage.load("windowState")},null):chrome.windows.update(a,{state:t.state},null)}))}!function(){const e="audioContext",t="gain-node",a=(e,t)=>{chrome.browserAction.setBadgeText({text:`${t}`,tabId:e})};this.stream=[];let o={};window.audioStates=o;const n=(a,n)=>{const s=new window.AudioContext,r=s.createMediaStreamSource(n);this.gain=s.createGain(),r.connect(this.gain),this.gain.connect(s.destination),o[a]={[e]:s,[t]:this.gain}},s=(e,a)=>{o[e][t].gain.value=a/100},r=(e,r)=>{if("fetch-gain-value"===e.action){let n=null;if(o[e.tabId]&&(n=o[e.tabId][t].gain.value),e.volumeLevel){n=e.volumeLevel;for(let e=0;e<this.stream.length;e++)this.stream[e]&&(this.stream[e].getTracks().forEach((e=>e.stop())),this.gain.disconnect());Object.keys(o).forEach((t=>a(+t,e.volumeLevel))),o={},this.stream=[]}return r({gainValue:n})}"change-volume"===e.action&&(o[e.tabId]?(s(e.tabId,e.sliderValue),a(e.tabId,e.sliderValue)):chrome.tabCapture.capture({audio:!0,video:!1},(t=>{this.stream.push(t),n(e.tabId,t),s(e.tabId,e.sliderValue),a(e.tabId,e.sliderValue)})))};chrome.tabs.onRemoved.addListener((t=>{o[t]&&o[t][e].close().then((()=>{delete o[t]}))})),chrome.runtime.onMessage.addListener(((e,t,a)=>{r(e,a)}))}(),chrome.tabCapture.onStatusChanged.addListener(fullScreen),chrome.commands.onCommand.addListener((async function(e){switch(e){case"increase_volume":chrome.tabs.query({currentWindow:!0,active:!0},(function(e){const{id:t}=e[0];getPrevVolumeValue(t).then((e=>{const a=e+50,o={action:"change-volume",tabId:t,sliderValue:a<=600?a+50:600};chrome.tabs.sendMessage(t,{action:"increase_volume",data:o})}))}));break;case"decrease_volume":chrome.tabs.query({currentWindow:!0,active:!0},(function(e){const{id:t}=e[0];getPrevVolumeValue(t).then((e=>{const a=e-50,o={action:"change-volume",tabId:t,sliderValue:a>=0?a:0};chrome.tabs.sendMessage(t,{action:"decrease_volume",data:o})}))}))}return!0}));const getPrevVolumeValue=e=>new Promise((t=>{chrome.browserAction.getBadgeText({tabId:e},(e=>{t(""===e?0:+e)}))}));class LocalStorageHelper{load(e){let t=window.localStorage[e];return void 0===t?null:JSON.parse(t)}save(e,t){return window.localStorage[e]=JSON.stringify(t),!0}}const LocalStorage=new LocalStorageHelper;